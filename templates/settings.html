{% extends 'base.html' %}

{% block title %} Settings {% endblock %}

{% block navlinks %}
<ul class="navbar-nav">
  <li class="nav-item">
  <a class="nav-link" href="/">Dashboard</a>
  </li>
  <li class="nav-item">
  <a class="nav-link active" aria-current="page" href="/settings">Settings</a>
  </li>
  <li class="nav-item">
  <a class="nav-link" href="/admin">Admin</a>
  </li>
</ul>
{% endblock %}

{% block content %}  
<div class="container">

<!-- Theme Card -->
<form name="theme" action="/settings" method="POST">
<div class="card shadow">
    <div class="card-header bg-primary text-light">
        <i class="fas fa-palette"></i>&nbsp; Theme Settings
    </div>
    <div class="card-body">
        <div class="form-group">
            <label for="sel1">Select a Theme:</label>
            <select class="form-select" id="theme" name="theme" aria-label="theme-select">
                {% for theme in settings['globals']['themelist'] %}
              <option value="{{ theme['name'] }}" {% if settings['globals']['theme'] == theme['filename'] %}selected{% endif %}>{{ theme['name'] }}</option>
                {% endfor %}
            </select>
        </div>
    </div>
    <div class="card-footer">
        <button type="submit" class="btn btn-primary">Set Theme</button>
    </div>
</div>
</form><br><br>

<!-- User Interface Card -->
<form name="ui" action="/settings" method="POST">
    <div class="card shadow">
        <div class="card-header bg-primary text-light">
            <i class="fa-solid fa-display"></i>&nbsp; User Interface Settings
        </div>
        <div class="card-body">

            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="show_all_thumbnails" name="show_all_thumbnails" {% if settings['ui']['show_all_thumbnails'] %}checked{% endif %}>
                <label class="form-check-label" for="show_all_thumbnails">Show All Thumbnails</label>
            </div>
            <i style="font-size: 12px;"><span class="badge text-bg-info">Note</span>
            &nbsp; This will allow you to see all thumbnails for all image files in the import folder, not just the images without a date. This may impact the page
            load time, is it could many more thumbnails.</i>
            <br>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" id="auto_flag_processed" name="auto_flag_processed" {% if settings['ui']['auto_flag_processed'] %}checked{% endif %}>
                <label class="form-check-label" for="auto_flag_processed">Auto Flag Processed</label>
            </div>
            <i style="font-size: 12px;"><span class="badge text-bg-info">Note</span>
            &nbsp; This will set the 'Processed' flag after a folder (and subfolders) gets processed. You can always manually change this flag by clicking the icon 
            in the 'Processed' column during folder selection.</i>
        
        </div>
        <div class="card-footer">
            <button type="submit" class="btn btn-primary">Save Settings</button>
        </div>
    </div>
</form><br><br>

<!-- Immich Secrets Card -->
<form name="immich" action="/settings" method="POST">
    <div class="card shadow">
        <div class="card-header bg-primary text-light">
            <i class="fa-solid fa-photo-film"></i>&nbsp; Immich Secrets Config
        </div>
        <div class="card-body">

            <div class="mb-3">
                <label for="immich_base_url" class="form-label">
                    <i class="fa-solid fa-globe"></i>&nbsp;
                    Immich Base URL/API
                </label>
                <input type="url" class="form-control" id="immich_base_url" aria-describedby="immich_base_url_help" name="immich_base_url" value="{{ secrets['base_url'] }}">
                <div id="immich_base_url_help" class="form-text">Default: http://127.0.0.1:2283/api</div>
            </div>
        
            <div class="mb-3">
                <label for="immich_api_key" class="form-label">
                    <i class="fa-solid fa-key"></i>&nbsp;
                    Immich API Key
                </label>
                <div class="input-group">
                    <input type="password" class="form-control" id="immich_api_key" aria-describedby="immich_api_key_help" name="immich_api_key" value="{{ secrets['api_key'] }}">
                    <div class="input-group-text">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="show_password">
                            <label class="form-check-label" for="show_password">Show/Hide</label>
                        </div>
                    </div>
                </div>                
                <div id="immich_base_url_help" class="form-text">Your Immich User API Key</div>
            </div>

        </div>
        <div class="card-footer">
            <button type="submit" class="btn btn-primary">Save Settings</button>
        </div>
    </div>
</form><br><br>

</div> <!-- End of Container -->
{% endblock %}

{% block scripts %} 
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordField = document.getElementById('immich_api_key');
        const showPasswordCheckbox = document.getElementById('show_password');
   
        if (passwordField && showPasswordCheckbox) {
            showPasswordCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    passwordField.type = 'text';
                } else {
                    passwordField.type = 'password';
                }
            });
        }
    });
</script>
{% endblock %}